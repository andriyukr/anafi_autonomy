<?xml version="1.0"?>

<launch>
	<arg name="name" default="anafi"/>
	<arg name="model" default="4k"/> <!-- {"4k", "thermal", "usa", "ai"} -->
	<arg name="ip" default="192.168.53.1"/> <!-- Anafi: "192.168.42.1", SkyController: "192.168.53.1" -->
	<arg name="skycontroller" default="true"/>

	<env name="ROSCONSOLE_FORMAT" value="[${severity}] [${time}] [${node}]: ${message}"/>
	
	<include file="$(find olympe_bridge)/launch/anafi.launch">
		<arg name="name" value="$(arg name)"/>
		<arg name="model" value="$(arg model)"/> 
		<arg name="ip" value="$(arg ip)"/>
		<arg name="skycontroller" value="$(arg skycontroller)"/>
	</include>
	
	<group ns="$(arg name)">
		<param name="safe_anafi/bounds/min_x" type="double" value="-5.0"/>
		<param name="safe_anafi/bounds/max_x" type="double" value="5.0"/>
		<param name="safe_anafi/bounds/min_y" type="double" value="-5.0"/>
		<param name="safe_anafi/bounds/max_y" type="double" value="5.0"/>
		<param name="safe_anafi/bounds/min_z" type="double" value="0.0"/>
		<param name="safe_anafi/bounds/max_z" type="double" value="2.0"/>

		<node name="set_trajectory_log_level" pkg="rosservice" type="rosservice" args="call --wait /$(arg name)/trajectory/set_logger_level 'ros.anafi_autonomy' 'info'"/>
		<node name="set_teleop_key_log_level" pkg="rosservice" type="rosservice" args="call --wait /$(arg name)/teleop_key/set_logger_level 'ros.anafi_autonomy' 'info'"/>
		<node name="set_rviz_log_level" pkg="rosservice" type="rosservice" args="call --wait /rviz/set_logger_level 'ros' 'error'"/>
			
		<node name="safe_anafi" pkg="anafi_autonomy" type="safe_anafi" output="screen" args=""/>
		<!-- Run in the terminal `xset r rate 10 40` to eliminate the delay after the first press of a key.
		Later, run in the terminal `xset r rate 240 40` to reset the default delay. -->
		<node name="teleop_key" pkg="anafi_autonomy" type="teleop_key" output="screen" args=""/>
		<node name="trajectory" pkg="anafi_autonomy" type="trajectory" output="screen" args=""/>
		
				
		<!-- node name="rviz" pkg="rviz" type="rviz" output="log" args=""/ -->
		<node name="rqt_image_view" pkg="rqt_image_view" type="rqt_image_view" args="/$(arg name)/camera/image"/>	
		<!-- Waits 1s before running dynamic_reconfigure -->
		<node name="dynamic_reconfigure" pkg="rqt_reconfigure" type="rqt_reconfigure" output="screen" args="" launch-prefix="bash -c 'sleep 1; $0 $@' "/>
	</group>
</launch>
